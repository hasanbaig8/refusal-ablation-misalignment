Breaking down "Have a function ablate_refusal that takes in a huggingface model, ablates refusal (at the weights level) at the best layer based on validation, and returns huggingface model":
(replicating relevant parts of this paper:
https://arxiv.org/pdf/2406.11717 )

1. Get activations for harmful_train and harmless_train each layer (want a function that just gives me a dataset of activations)
2. Compute mean over each harm_type and layer
3. Take the difference between harm_types each layer
4 Ablate every layer (every matrix that writes to residual stream)
5. Return the model with this ablation